<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Manpage for fccanalysis-script
   Contact FCC-PED-SoftwareAndComputing-Analysis@cern.ch to correct errors or typos.
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="../../css/mandoc.css" type="text/css" media="all"/>
  <title>FCCANALYSIS-SCRIPT(7)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">FCCANALYSIS-SCRIPT(7)</td>
    <td class="head-vol">fccanalysis-script man page</td>
    <td class="head-rtitle">FCCANALYSIS-SCRIPT(7)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><b>fccanalysis-script</b> &#x2013; analysis steering script
    specification</p>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<dl class="Bl-tag">
  <dt></dt>
  <dd>*
    <p class="Pp"></p>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The analysis script is expected to be a valid Python script
    containing either part of or the full analysis. There are two basic modes
    how to run an analysis, one is to run in the managed mode like so:</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>fccanalysis run <i>analysis_script.py</i></dd>
</dl>
<p class="Pp">or</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>fccanalysis final <i>analysis_script.py</i>
    <p class="Pp"></p>
  </dd>
</dl>
<p class="Pp">where user needs to provide a set of required attributes and
    definitions in their analysis script. In this mode the RDataFrame is managed
    for the user and the analysis behavior can be controlled by providing
    additional attributes in the analysis script. The other mode is to run the
    analysis script as a regular python script:</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>python <i>analysis_script.py</i></dd>
</dl>
<p class="Pp">here user has full control over the RDataFrame, but has to create
    all necessary scaffolding.</p>
<p class="Pp"></p>
<p class="Pp">Usually it is the case that the whole analysis will be split into
    several stages, which can be done in one of the two styles:</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>anascript_stage1.py -&gt; anascript_stage2.py -&gt; ... -&gt;
      anascript_stage_final.py -&gt; plots.py</dd>
</dl>
<p class="Pp">or</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>analysis_histmaker.py -&gt; plots.py
    <p class="Pp"></p>
  </dd>
</dl>
<p class="Pp">In the case of the first style there are at least three stages
    required (e.g. <i>anascript_stage1.py</i>, <i>anascript_stage_final.py</i>,
    <i>plots.py</i>) and there is no upper limit on the number of stages. In the
    case of the second style only two stages are required. The first style is
    named &quot;staged style&quot; and the second &quot;histmaker
  style&quot;.</p>
<dl class="Bl-tag">
  <dt id="Staged"><a class="permalink" href="#Staged"><b>Staged style
    analysis</b></a></dt>
  <dd>The analysis script needs to contain <i>Analysis</i> class of the
      following structure:</dd>
</dl>
<dl class="Bl-tag">
  <dt></dt>
  <dd>class Analysis():
    <br/>
     def __init__(self, cmdline_args):
    <br/>
     ...
    <p class="Pp">
      <br/>
       def analyzers(self, dframe):
      <br/>
       dframe2 = (
      <br/>
       dframe
      <br/>
       # define the muon collection
      <br/>
       .Define(&quot;muons&quot;,
      <br/>
       &quot;ReconstructedParticle::get(Muon0, ReconstructedParticles)&quot;)
      <br/>
       ...
      <br/>
       )
      <br/>
       return dframe2</p>
    <p class="Pp">
      <br/>
       def output(self):
      <br/>
       return [&quot;muons&quot;, &quot;muon_mass&quot;]</p>
  </dd>
</dl>
<dl class="Bl-tag">
  <dt id="Histmaker"><a class="permalink" href="#Histmaker"><b>Histmaker style
    analysis</b></a></dt>
  <dd>The analysis script needs to contain <i>build_graph</i> function of the
      following structure:</dd>
</dl>
<dl class="Bl-tag">
  <dt></dt>
  <dd>def build_graph(df, dataset):
    <br/>
     results = []
    <br/>
     df = df.Define(&quot;weight&quot;, &quot;1.0&quot;)
    <br/>
     weightsum = df.Sum(&quot;weight&quot;)
    <br/>
     df = df.Define(&quot;muons&quot;,
      &quot;FCCAnalyses::ReconstructedParticle::sel_p(20)(muons_all)&quot;)
    <br/>
     ...
    <br/>
     results.append(df.Histo1D((&quot;muons_p_cut0&quot;, &quot;&quot;,
      *bins_p_mu), &quot;muons_p&quot;))
    <br/>
     return results, weightsum</dd>
</dl>
<dl class="Bl-tag">
  <dt id="Final"><a class="permalink" href="#Final"><b>Final and Plots
    stages</b></a></dt>
  <dd>These stages do not require <i>Analysis</i> class neither
      <i>build_graph</i> function, they have their own set of attributes, please
      see the examples in the <i>examples</i> of FCCAnalyses repository or
      fccanalysis-final-script(7) and fccanalysis-plots-script(7) manual pages.
    <p class="Pp"></p>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="ATTRIBUTES"><a class="permalink" href="#ATTRIBUTES">ATTRIBUTES</a></h1>
<p class="Pp">In case of running the FCCAnalysis in the staged style user
    can/should add the following attributes to the <i>Analysis</i> class in
    order to control the behavior of the analysis.</p>
<dl class="Bl-tag">
  <dt id="process_list"><a class="permalink" href="#process_list"><b>process_list</b>
    (mandatory)</a></dt>
  <dd>Dictionary of process samples to be run over. Each process can have
      several parameters:
    <br/>
    <i>fraction</i>
    <br/>
    The analysis will run over reduced number of input files roughly
      corresponding to the fraction of total events specified.
    <br/>
    Default value: 1 (full process sample)
    <br/>
    <i>input_dir</i>
    <br/>
    Specifies the location of the process different from the globally set one.
      This overrides both prod_tag and input_dir attributes of the analysis
      script.
    <br/>
    Default value: None
    <br/>
    <i>output</i>
    <br/>
    Specifies the stem for the output file(s). The stem will be used to create
      output directory if there is more than one chunk or as a filename if there
      is only one.
    <br/>
    Default value: output.root
    <br/>
    <i>chunks</i>
    <br/>
    The analysis can be split into several output chunks (useful on distributed
      systems).
    <br/>
    Default value: 1</dd>
  <dt id="prod_tag"><a class="permalink" href="#prod_tag"><b>prod_tag</b>
    (mandatory)</a></dt>
  <dd>Provides information where to find input files. There are several way how
      to find the information, one of them uses YAML file which is being
      searched for in the sub-folders of $FCCDICTSDIR.</dd>
  <dt id="output_dir"><a class="permalink" href="#output_dir"><b>output_dir</b>
    (mandatory)</a></dt>
  <dd>User can specify the directory for the output files.</dd>
  <dt id="analysis_name"><a class="permalink" href="#analysis_name"><b>analysis_name</b>
    (optional)</a></dt>
  <dd>Optional name for the analysis
    <br/>
    Default value: empty string</dd>
  <dt id="n_threads"><a class="permalink" href="#n_threads"><b>n_threads</b>
    (optional)</a></dt>
  <dd>Number of threads the RDataFrame will use during processing. To use all
      threads available on the machine specify -1.
    <br/>
    Default value: 1</dd>
  <dt id="inlude_paths"><a class="permalink" href="#inlude_paths"><b>inlude_paths</b>
    (optional)</a></dt>
  <dd>Specify additional include header files to be JIT compiled.
    <br/>
    Default value: None</dd>
  <dt id="batch_queue"><a class="permalink" href="#batch_queue"><b>batch_queue</b>
    (optional)</a></dt>
  <dd>Batch queue name when running on HTCondor.
    <br/>
    Default value: &quot;longlunch&quot;</dd>
  <dt id="comp_group"><a class="permalink" href="#comp_group"><b>comp_group</b>
    (optional)</a></dt>
  <dd>Computing account when running on HTCondor.
    <br/>
    Default value: &quot;group_u_FCC.local_gen&quot;</dd>
  <dt id="output_dir_eos"><a class="permalink" href="#output_dir_eos"><b>output_dir_eos</b>
    (optional)</a></dt>
  <dd>Output directory on EOS, recognized only when submitting to HTCondor. If
      specified files will be copied there once the batch job is done. A string
      (<b>str</b>) or a template (<b>string.Template</b>) can be provided. In
      case of the template only one variable is currently supported:
      <b>$timestamp</b>.
    <br/>
    Default value: None</dd>
  <dt id="eos_type"><a class="permalink" href="#eos_type"><b>eos_type</b>
    (optional)</a></dt>
  <dd>Type of the EOS proxy to be used.
    <br/>
    Default value: user</dd>
  <dt id="test_file"><a class="permalink" href="#test_file"><b>test_file</b>
    (optional)</a></dt>
  <dd>Location of the test file provided as a string (<b>str</b>) or a template
      (<b>string.Template</b>). In case of the template two variables are
      supported: <b>$key4hep_os</b> and <b>$key4hep_stack</b>.
    <br/>
    Default value: empty string</dd>
  <dt id="graph"><a class="permalink" href="#graph"><b>graph</b>
    (optional)</a></dt>
  <dd>The computational graph of the analysis will be generated.
    <br/>
    Default value: False</dd>
  <dt id="graph_path"><a class="permalink" href="#graph_path"><b>graph_path</b>
    (optional)</a></dt>
  <dd>Location where the computational graph of the analysis should be stored.
      Only paths with <i>.dot</i> and <i>.png</i> extensions are accepted.
    <br/>
    Default value: empty string</dd>
  <dt id="use_data_source"><a class="permalink" href="#use_data_source"><b>use_data_source</b>
    (optional)</a></dt>
  <dd>User can specify how to provide physical object collections to the
      analyzers. If <i>True</i> the events will be loaded through the EDM4hep
      RDataSource.
    <br/>
    Default value: False</dd>
  <dt id="do_weighted"><a class="permalink" href="#do_weighted"><b>do_weighted</b>
    (optional)</a></dt>
  <dd>Whether to use weighted or raw events. If <i>True</i> the events will be
      weighted with EDM4hep's EventHeader.weight and all normalisation factors
      calculated with sum of weights accordingly.
    <br/>
    Default value: False</dd>
  <dt id="proc_dict"><a class="permalink" href="#proc_dict"><b>proc_dict</b></a></dt>
  <dd>This variable controls which process dictionary will be used. It can be
      either simple file name, absolute path or url. In the case of simple
      filename, the file is being searched for first in the working directory
      and then at the locations indicated in the $FCCDICTSDIR environment
      variable.</dd>
  <dt id="n_events_max"><a class="permalink" href="#n_events_max"><b>n_events_max</b></a></dt>
  <dd>Allows to limit the amount of events to be processed. The limit is applied
      per sample.</dd>
</dl>
<p class="Pp">This section is under construction. You are invited to help :)</p>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">fccanalysis(1), fccanalysis-run(1)</p>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS"><a class="permalink" href="#BUGS">BUGS</a></h1>
<p class="Pp">Many</p>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<p class="Pp">There are many contributors to the FCCAnalyses framework, but the
    principal authors are:
  <br/>
  Clement Helsens
  <br/>
  Valentin Volkl
  <br/>
  Gerardo Ganis</p>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="FCCANALYSES"><a class="permalink" href="#FCCANALYSES">FCCANALYSES</a></h1>
<p class="Pp">Part of the FCCAnalyses framework.</p>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="LINKS"><a class="permalink" href="#LINKS">LINKS</a></h1>
<p class="Pp"><a class="Lk" href="https://hep-fcc.github.io/FCCAnalyses/">FCCAnalyses
    webpage</a></p>
<p class="Pp"><a class="Lk" href="https://github.com/HEP-FCC/FCCAnalyses/">FCCAnalysises
    GitHub repository</a></p>
<p class="Pp"><a class="Lk" href="https://fccsw-forum.web.cern.ch/">FCCSW
    Forum</a></p>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="CONTACT"><a class="permalink" href="#CONTACT">CONTACT</a></h1>
<p class="Pp"><a class="Mt" href="mailto:FCC-PED-SoftwareAndComputing-Analysis@cern.ch">FCC-PED-SoftwareAndComputing-Analysis</a></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">12 Nov 2025</td>
    <td class="foot-os">0.12.0</td>
  </tr>
</table>
</body>
</html>
